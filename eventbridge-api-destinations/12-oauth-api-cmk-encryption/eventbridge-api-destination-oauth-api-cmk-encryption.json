{
    "title": "EventBridge API Destinations with OAuth credentials using CMK encryption",
    "description": "Create an EventBridge rule and API Destination with OAuth credentials using Customer Managed Key (CMK) encryption",
    "language": "Node.js",
    "level": "100",
    "framework": "AWS SAM",
    "services": {
        "from": "eventbridge",
        "to": "eventbridge"
    },
    "introBox": {
        "headline": "How it works",
        "text": [
            "This pattern configures an EventBridge rule that routes to an API Destinations target using Oauth credentials with Customer Managed Key (CMK) encryption. It configures a Connection, which contains the authorization for the API endpoint with CMK encryption, and the API, which contains the URL, http method, and other configuration information."
        ],
        "test": ""
    },
    "deploy": {
        "text": [
            "cd ./12-oauth-api-with-cmk-encryption",
            "sam deploy --guided"
        ]
    },
    "testing": {
        "headline": "Testing",
        "text": [
            "1. From a command line in this directory, send a test event to EventBridge simulating a \"EventBridge CMK Demo success\" event: <code>aws events put-events --entries file://testEvent.json</code>"
        ]
    },
    "cleanup": {
        "headline": "Cleanup",
        "text": [
            "1. Delete the stack: <code>sam delete --stack-name STACK_NAME</code>.",
            "2. Confirm the stack has been deleted: <code>aws cloudformation list-stacks --query \"StackSummaries[?contains(StackName,'STACK_NAME')].StackStatus\"</code>"
        ]
    },
    "gitHub": {
        "template": {
            "projectFolder": "eventbridge-api-destinations",
            "repoURL": "https://github.com/aws-samples/serverless-patterns/tree/main/eventbridge-api-destinations/12-oauth-api-with-cmk-encryption",
            "templateURL": "serverless-patterns/eventbridge-api-destinations",
            "templateFile": "12-oauth-api-with-cmk-encryption/template.yaml"
        },
        "payloads": [
            {
                "headline": "",
                "payloadURL": ""
            }
        ]
    },
    "resources": {
        "headline": "Additional resources",
        "bullets": [
            {
                "text": "Amazon EventBridge now supports Customer Managed Keys (CMK) in API destinations connections",
                "link": "https://aws.amazon.com/about-aws/whats-new/2025/04/amazon-eventbridge-customer-managed-keys-api/"
            },
            {
                "text": "Encrypting EventBridge connection authorization with AWS KMS keys",
                "link": "https://docs.aws.amazon.com/eventbridge/latest/userguide/encryption-connections.html"
            },
            {
                "text": "Using API destinations with Amazon EventBridge",
                "link": "https://aws.amazon.com/blogs/compute/using-api-destinations-with-amazon-eventbridge/"
            },
            {
                "text": "Use Amazon EventBridge to Build Decoupled, Event-Driven Architectures",
                "link": "https://serverlessland.com/learn/eventbridge"
            }
        ]
    },
    "authors": [
        {
            "name": "Rajesh Kumar",
            "image": "https://avatars.githubusercontent.com/u/4745639",
            "bio": "Rajesh Kumar is a Technical Account Manager (TAM) at Amazon Web Services (AWS) and contributor to ServerlessLand. He is passionate about serverless and wants to help everyone get started with serverless and what can be done with it.",
            "linkedin": "rajeshk1988"
        },
        {
            "name": "Biswanath Mukherjee",
            "image": "https://d1rwvjey2iif32.cloudfront.net",
            "bio": "I am a Sr. Solutions Architect working at AWS India.",
            "linkedin": "biswanathmukherjee"
        }
    ],
    "tags": [
        "EventBridge",
        "API Destinations",
        "OAuth",
        "CMK Encryption",
        "Serverless"
    ],
    "patternArch": {
        "icon1": {
            "x": 15,
            "y": 50,
            "service": "eventbridge",
            "label": "EventBridge rule"
        },
        "group": {
            "x": 30,
            "y": 20,
            "w": 65,
            "h": 60,
            "label": "API Destinations"
        },
        "icon2": {
            "x": 40,
            "y": 50,
            "service": "eventbridge-connection.png",
            "label": "Connection"
        },
        "icon3": {
            "x": 85,
            "y": 50,
            "service": "eventbridge-api.png",
            "label": "API"
        },
        "line1": {
            "from": "icon1",
            "to": "icon2",
            "label": ""
        },
        "line2": {
            "from": "icon2",
            "to": "icon3",
            "label": "with OAuth using CMK encryption"
        }
    }
}
